# Структура базы данных аптеки

## Обзор
Система управления аптекой состоит из 6 основных таблиц:

## Таблицы

### 1. dbusers (Пользователи системы)
- **ID_User** (PK) - Уникальный идентификатор пользователя
- **user_email** (UNIQUE) - Email пользователя
- **user_password** - Пароль пользователя
- **user_role** - Роль пользователя (pharmacy_admin, pharmacist, cashier, pharmacy_user)
- **created_at** - Дата создания аккаунта

### 2. Supplier (Поставщики)
- **ID_Supplier** (PK) - Уникальный идентификатор поставщика
- **SupplierName** - Название поставщика
- **ContactPerson** - Контактное лицо
- **Phone** - Телефон
- **Email** - Email
- **Address** - Адрес
- **created_at** - Дата добавления

### 3. Medicine (Лекарства)
- **ID_Medicine** (PK) - Уникальный идентификатор лекарства
- **MedicineName** - Название лекарства
- **ActiveSubstance** - Действующее вещество
- **Dosage** - Дозировка
- **Form** - Форма выпуска (таблетки, сироп, мазь и т.д.)
- **PrescriptionRequired** - Требуется ли рецепт
- **Price** - Цена продажи
- **ID_Supplier** (FK) - Ссылка на поставщика

### 4. Inventory (Инвентарь/Остатки)
- **ID_Inventory** (PK) - Уникальный идентификатор записи инвентаря
- **ID_Medicine** (FK) - Ссылка на лекарство
- **BatchNumber** - Номер партии
- **Quantity** - Количество на складе
- **ExpiryDate** - Срок годности
- **PurchasePrice** - Цена закупки
- **PurchaseDate** - Дата закупки

### 5. Sales (Продажи)
- **ID_Sale** (PK) - Уникальный идентификатор продажи
- **SaleDate** - Дата и время продажи
- **CustomerName** - Имя покупателя
- **CustomerPhone** - Телефон покупателя
- **TotalAmount** - Общая сумма продажи
- **PaymentMethod** - Способ оплаты
- **ID_User** (FK) - Ссылка на пользователя (кто продал)

### 6. SaleItems (Позиции продаж)
- **ID_SaleItem** (PK) - Уникальный идентификатор позиции продажи
- **ID_Sale** (FK) - Ссылка на продажу
- **ID_Medicine** (FK) - Ссылка на лекарство
- **Quantity** - Количество проданного товара
- **UnitPrice** - Цена за единицу
- **TotalPrice** - Общая цена позиции

## Связи между таблицами

```
Supplier (1) -----> (N) Medicine (1) -----> (N) Inventory
                                          |
                                          v
Sales (1) -----> (N) SaleItems (N) -----> Medicine
  |
  v
dbusers
```

## Триггеры и функции

### 1. update_inventory_on_sale()
- Автоматически уменьшает остатки при продаже
- Проверяет достаточность товара на складе
- Проверяет срок годности

### 2. check_expiry_date()
- Проверяет срок годности при добавлении товара
- Не позволяет добавлять просроченные товары

### 3. calculate_sale_total()
- Автоматически рассчитывает общую сумму продажи
- Обновляет поле TotalAmount в таблице Sales

## Представления (Views)

### inventory_view
Объединяет информацию об инвентаре с данными о лекарствах и поставщиках, включая статус товара (годен/скоро истекает/просрочен).

## Роли пользователей

1. **pharmacy_admin** - Полный доступ ко всем функциям
2. **pharmacist** - Доступ к управлению лекарствами и инвентарем
3. **cashier** - Доступ только к продажам и просмотру остатков
4. **pharmacy_user** - Базовый доступ для просмотра информации

